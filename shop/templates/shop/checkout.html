{% extends "base.html" %}
{% load shop_filters %}

{% block title %}Commande — {{ site_name }}{% endblock %}

{% block content %}
  <div class="flex items-end justify-between gap-4">
    <div>
      <h1 class="text-2xl font-extrabold tracking-tight">Passer commande</h1>
      <p class="mt-1 text-sm text-slate-600">Renseignez vos informations pour finaliser.</p>
    </div>
    <a
      href="{% url 'shop:cart_detail' %}"
      class="rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold hover:bg-slate-50"
    >
      Retour au panier
    </a>
  </div>

  <div class="mt-6 grid gap-6 lg:grid-cols-3">
    <div class="lg:col-span-2">
      <form method="post" class="rounded-2xl border border-slate-200 bg-white p-5">
        {% csrf_token %}

        <div class="grid gap-4 md:grid-cols-2">
          <div>
            <label class="block text-sm font-semibold" for="{{ form.customer_name.id_for_label }}">{{ form.customer_name.label }}</label>
            {{ form.customer_name }}
            {% if form.customer_name.errors %}<div class="mt-1 text-xs text-rose-700">{{ form.customer_name.errors }}</div>{% endif %}
          </div>
          <div>
            <label class="block text-sm font-semibold" for="{{ form.customer_phone.id_for_label }}">{{ form.customer_phone.label }}</label>
            {{ form.customer_phone }}
            {% if form.customer_phone.errors %}<div class="mt-1 text-xs text-rose-700">{{ form.customer_phone.errors }}</div>{% endif %}
          </div>
          <div class="md:col-span-2">
            <label class="block text-sm font-semibold" for="{{ form.customer_email.id_for_label }}">{{ form.customer_email.label }}</label>
            {{ form.customer_email }}
            {% if form.customer_email.errors %}<div class="mt-1 text-xs text-rose-700">{{ form.customer_email.errors }}</div>{% endif %}
          </div>
          <div class="md:col-span-2">
            <label class="block text-sm font-semibold" for="{{ form.address.id_for_label }}">{{ form.address.label }}</label>
            {{ form.address }}
            {% if form.address.errors %}<div class="mt-1 text-xs text-rose-700">{{ form.address.errors }}</div>{% endif %}
          </div>
          <div>
            <label class="block text-sm font-semibold" for="{{ form.city.id_for_label }}">{{ form.city.label }}</label>
            {{ form.city }}
            {% if form.city.errors %}<div class="mt-1 text-xs text-rose-700">{{ form.city.errors }}</div>{% endif %}
          </div>
          <div>
            <label class="block text-sm font-semibold" for="{{ form.payment_method.id_for_label }}">{{ form.payment_method.label }}</label>
            {{ form.payment_method }}
            {% if form.payment_method.errors %}<div class="mt-1 text-xs text-rose-700">{{ form.payment_method.errors }}</div>{% endif %}
          </div>
          <div class="md:col-span-2">
            <label class="block text-sm font-semibold" for="{{ form.notes.id_for_label }}">{{ form.notes.label }}</label>
            {{ form.notes }}
            {% if form.notes.errors %}<div class="mt-1 text-xs text-rose-700">{{ form.notes.errors }}</div>{% endif %}
          </div>
        </div>

        <button
          type="submit"
          class="mt-6 w-full rounded-xl bg-emerald-600 px-4 py-3 text-sm font-semibold text-white hover:bg-emerald-700"
        >
          Confirmer la commande
        </button>
      </form>
    </div>

    <div>
      <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
        <div class="text-sm text-slate-500">Résumé</div>
        <div class="mt-1 text-2xl font-extrabold">{{ total_xof|xof }}</div>
        <div class="mt-4 space-y-3">
          {% for line in lines %}
            <div class="flex items-start justify-between gap-3 text-sm">
              <div class="flex-1">
                <div class="font-semibold">{{ line.product.name }}</div>
                <div class="text-slate-500">× {{ line.quantity }}</div>
              </div>
              <div class="font-semibold">{{ line.line_total_xof|xof }}</div>
            </div>
          {% endfor %}
        </div>
        <div class="mt-4 rounded-xl bg-slate-50 p-3 text-xs text-slate-600">
          Paiement: livraison / Orange Money / Wave. Vous serez contacté pour confirmer.
        </div>
      </div>
    </div>
  </div>
{% endblock %}

