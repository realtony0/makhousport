{% extends "base.html" %}
{% load shop_filters %}

{% block title %}{{ product.name }} — {{ site_name }}{% endblock %}

{% block content %}
  <div class="mb-6 text-sm text-slate-600">
    <a href="{% url 'shop:product_list' %}" class="hover:underline">Boutique</a>
    <span class="mx-2">/</span>
    <a href="{% url 'shop:product_list_by_category' category_slug=product.category.slug %}" class="hover:underline">
      {{ product.category.name }}
    </a>
  </div>

  <div class="grid gap-8 md:grid-cols-2">
    <div>
      {% with images=product.images.all %}
        {% if images %}
          <div class="overflow-hidden rounded-3xl border border-slate-200 bg-white">
            <img
              src="{{ images.0.image.url }}"
              alt="{{ images.0.alt_text|default:product.name }}"
              class="h-full w-full object-cover"
            />
          </div>
          {% if images|length > 1 %}
            <div class="mt-3 grid grid-cols-4 gap-3">
              {% for img in images %}
                <div class="overflow-hidden rounded-2xl border border-slate-200 bg-white">
                  <img
                    src="{{ img.image.url }}"
                    alt="{{ img.alt_text|default:product.name }}"
                    class="aspect-square w-full object-cover"
                    loading="lazy"
                  />
                </div>
              {% endfor %}
            </div>
          {% endif %}
        {% else %}
          <div class="flex aspect-square items-center justify-center rounded-3xl border border-slate-200 bg-white text-sm text-slate-500">
            Image indisponible
          </div>
        {% endif %}
      {% endwith %}
    </div>

    <div>
      <div class="text-sm text-slate-500">{{ product.category.name }}</div>
      <h1 class="mt-1 text-3xl font-extrabold tracking-tight">{{ product.name }}</h1>

      <div class="mt-4 flex items-baseline gap-3">
        <div class="text-2xl font-extrabold">{{ product.price_xof|xof }}</div>
        {% if product.compare_at_price_xof %}
          <div class="text-sm text-slate-500 line-through">{{ product.compare_at_price_xof|xof }}</div>
        {% endif %}
      </div>

      <div class="mt-2 text-sm text-slate-600">
        {% if product.stock > 0 %}
          <span class="font-semibold text-emerald-700">En stock</span> — {{ product.stock }} disponible(s)
        {% else %}
          <span class="font-semibold text-rose-700">Rupture de stock</span>
        {% endif %}
      </div>

      {% if product.description %}
        <div class="mt-6 text-sm leading-relaxed text-slate-700">
          {{ product.description|linebreaks }}
        </div>
      {% else %}
        <p class="mt-6 text-sm text-slate-600">
          Description bientôt disponible. Pour plus d'infos, contactez-nous.
        </p>
      {% endif %}

      <div class="mt-8 rounded-2xl border border-slate-200 bg-white p-5">
        <form action="{% url 'shop:cart_add' product_id=product.id %}" method="post" class="flex flex-wrap items-end gap-3">
          {% csrf_token %}
          <div>
            <label class="block text-sm font-semibold" for="quantity">Quantité</label>
            <input
              id="quantity"
              name="quantity"
              type="number"
              min="1"
              value="1"
              class="mt-1 w-28 rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm outline-none ring-slate-200 focus:ring"
              {% if product.stock <= 0 %}disabled{% endif %}
            />
          </div>
          <button
            type="submit"
            class="rounded-xl bg-slate-900 px-5 py-3 text-sm font-semibold text-white hover:bg-slate-800 disabled:cursor-not-allowed disabled:bg-slate-300"
            {% if product.stock <= 0 %}disabled{% endif %}
          >
            Ajouter au panier
          </button>
          <a
            href="{% url 'shop:cart_detail' %}"
            class="rounded-xl border border-slate-200 bg-white px-5 py-3 text-sm font-semibold hover:bg-slate-50"
          >
            Voir le panier
          </a>
        </form>
      </div>
    </div>
  </div>
{% endblock %}
